#!/bin/sh

# Exit if any error occurred
set -e

LOCATION="$@"

# Check if session type is Wayland or not
if [ "$XDG_SESSION_TYPE" = "wayland" ]; then
    CLIPBOARD_COMMAND="wl-copy"
else
    CLIPBOARD_COMMAND="xclip -selection clipboard"
fi

# If no location is provided, default to home directory
if [[ $LOCATION == "" ]]; then
    LOCATION="$HOME"
fi

# If no argument passed then prompt the user to select a file using `fzf`
if [[ -f $LOCATION ]]; then
    file_to_upload=$LOCATION
else
    file_to_upload=$(find -type f $LOCATION | fzf -i)
fi

url=$(curl -sS -F "expires=1" -F "file=@$file_to_upload" https://0x0.st)

# Copy the URL to clipboard and echo it
echo "$url" | $CLIPBOARD_COMMAND; echo "$url"
